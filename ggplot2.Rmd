---
title: "Visualisation with ggplot2"
author: "Florian PrivÃ© & "
date: "October 19, 2017"
output:
  xaringan::moon_reader:
    includes:
      after_body: include_twitter.html
    lib_dir: libs
    chakra: libs/remark-latest.min.js
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(cache = TRUE, fig.align = "center")
```

class: center, middle, inverse
background-image: url(http://hexb.in/vector/ggplot2.svg)
background-size: 50%

---

class: center, middle, inverse

> "The simple graph has brought more information to the data analystâ€™s mind than any other device." --- John Tukey

---

## Sources

- [Chapter *Data Visualisation*](http://r4ds.had.co.nz/data-visualisation.html) of 

```{r, out.height='300px', echo=FALSE}
knitr::include_graphics("http://r4ds.had.co.nz/cover.png")
```

<!-- - This [workshop on introducting the tidyverse](https://github.com/Cascadia-R/gRadual-intRoduction-tidyverse) -->

- [StackOverflow questions with tag `[ggplot2]`](https://stackoverflow.com/questions/tagged/ggplot2)

---

class: center, middle, inverse

# Introduction

---

## What does *ggplot2* stand for?

--

### A __Grammar of Graphics__!

--

```
ggplot(data = <DATA>) + 
  <GEOM_FUNCTION>(
     mapping = aes(<MAPPINGS>),
     stat = <STAT>, 
     position = <POSITION>
  ) +
  <COORDINATE_FUNCTION> +
  <FACET_FUNCTION>
```

--

</br>

#### You can uniquely describe any plot as a combination of these 7 parameters.

---

## How long have you known **ggplot2**?

<br>
<br>
<br>

--

<blockquote class="twitter-tweet" data-lang="en" align="center"><p lang="en" dir="ltr">Happy 10th birthday ggplot2! ðŸŽ‰ðŸŽ‚ðŸ“ŠðŸ“ˆ10 years ago today the first version was accepted to CRAN: <a href="https://t.co/tiXIkqnCcA">https://t.co/tiXIkqnCcA</a></p>&mdash; Hadley Wickham (@hadleywickham) <a href="https://twitter.com/hadleywickham/status/873556949207535616">10 juin 2017</a></blockquote>

---

## Why use ggplot2?

</br>

- Automatic legends, colors, etc.

- Easy superposition, facetting, etc.

- Nice rendering (yet, I don't like the default grey theme).

- **Store any ggplot2 object for modification or future recall.** Super useful for packages.

- Lots of users (less bugs, much help on Stack Overflow).

- Lots of extensions.

- Nice saving option.

---

class: center, middle, inverse
background-image: url(http://spatialanalysis.co.uk/wp-content/uploads/2012/06/flights_sml.jpg)
background-size: 100%

---

class: center, middle, inverse

# Tidy data?

---

## Untidy data

```{r, include=FALSE}
library(tidyverse)
fertilityData <- structure(list(`Total fertility rate` = structure(c(2L, 5L, 6L, 
9L, 11L, 12L, 13L, 14L, 15L, 16L, 17L, 18L), .Label = c("Abkhazia", 
"Afghanistan", "Akrotiri and Dhekelia", "Ã…land", "Albania", 
"Algeria", "American Samoa", "Andorra", "Angola", "Anguilla", 
"Antigua and Barbuda", "Argentina", "Armenia", "Aruba", "Australia", 
"Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", 
"Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bermuda", 
"Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", 
"British Virgin Islands", "Brunei", "Bulgaria", "Burkina Faso", 
"Burundi", "Cambodia", "Cameroon", "Canada", "Cape Verde", "Cayman Islands", 
"Central African Republic", "Chad", "Channel Islands", "Chile", 
"China", "Christmas Island", "Cocos Island", "Colombia", "Comoros", 
"Congo, Dem. Rep.", "Congo, Rep.", "Cook Is", "Costa Rica", "Cote d'Ivoire", 
"Croatia", "Cuba", "Cyprus", "Czech Republic", "Czechoslovakia", 
"Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Germany", 
"Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", 
"Eritrea and Ethiopia", "Estonia", "Ethiopia", "Faeroe Islands", 
"Falkland Is (Malvinas)", "Fiji", "Finland", "France", "French Guiana", 
"French Polynesia", "Gabon", "Gambia", "Georgia", "Germany", 
"Ghana", "Gibraltar", "Greece", "Greenland", "Grenada", "Guadeloupe", 
"Guam", "Guatemala", "Guernsey", "Guinea", "Guinea-Bissau", "Guyana", 
"Haiti", "Holy See", "Honduras", "Hong Kong, China", "Hungary", 
"Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Isle of Man", 
"Israel", "Italy", "Jamaica", "Japan", "Jersey", "Jordan", "Kazakhstan", 
"Kenya", "Kiribati", "Kosovo", "Kuwait", "Kyrgyz Republic", "Lao", 
"Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", 
"Lithuania", "Luxembourg", "Macao, China", "Macedonia, FYR", 
"Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", 
"Marshall Islands", "Martinique", "Mauritania", "Mauritius", 
"Mayotte", "Mexico", "Micronesia, Fed. Sts.", "Moldova", "Monaco", 
"Mongolia", "Montenegro", "Montserrat", "Morocco", "Mozambique", 
"Myanmar", "Namibia", "Nauru", "Nepal", "Netherlands", "Netherlands Antilles", 
"New Caledonia", "New Zealand", "Ngorno-Karabakh", "Nicaragua", 
"Niger", "Nigeria", "Niue", "Norfolk Island", "North Korea", 
"North Yemen (former)", "Northern Cyprus", "Northern Mariana Islands", 
"Norway", "Oman", "Pakistan", "Palau", "Panama", "Papua New Guinea", 
"Paraguay", "Peru", "Philippines", "Pitcairn", "Poland", "Portugal", 
"Puerto Rico", "Qatar", "Reunion", "Romania", "Russia", "Rwanda", 
"Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", 
"Senegal", "Serbia", "Serbia and Montenegro", "Serbia excluding Kosovo", 
"Seychelles", "Sierra Leone", "Singapore", "Slovak Republic", 
"Slovenia", "Solomon Islands", "Somalia", "Somaliland", "South Africa", 
"South Korea", "South Ossetia", "South Yemen (former)", "Spain", 
"Sri Lanka", "St. BarthÃ©lemy", "St. Helena", "St. Kitts and Nevis", 
"St. Lucia", "St. Martin", "St. Vincent and the Grenadines", 
"St.-Pierre-et-Miquelon", "Sudan", "Suriname", "Svalbard", "Swaziland", 
"Sweden", "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania", 
"Thailand", "Timor-Leste", "Togo", "Tokelau", "Tonga", "Transnistria", 
"Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Turks and Caicos Islands", 
"Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", 
"United Korea (former)\n", "United States", "Uruguay", "USSR", 
"Uzbekistan", "Vanuatu", "Venezuela", "Vietnam", "Virgin Islands (U.S.)", 
"Wallis et Futuna", "West Bank and Gaza", "West Germany", "Western Sahara", 
"Yemen", "Yugoslavia", "Zambia", "Zimbabwe"), class = "factor"), 
    `1800` = c(7, 4.6, 6.99, 6.93, 5, 6.8, 7.8, 5.64, 6.5, 5.1, 
    8.1, 5.9), `1801` = c(7, 4.6, 6.99, 6.93, 5, 6.8, 7.8, 5.64, 
    6.48, 5.1, 8.1, 5.9), `1802` = c(7, 4.6, 6.99, 6.93, 4.99, 
    6.8, 7.81, 5.64, 6.46, 5.1, 8.1, 5.9), `1803` = c(7, 4.6, 
    6.99, 6.93, 4.99, 6.8, 7.81, 5.64, 6.44, 5.1, 8.1, 5.9), 
    `1804` = c(7, 4.6, 6.99, 6.93, 4.99, 6.8, 7.81, 5.64, 6.42, 
    5.1, 8.1, 5.9), `1805` = c(7, 4.6, 6.99, 6.93, 4.98, 6.8, 
    7.82, 5.64, 6.4, 5.1, 8.1, 5.9)), .Names = c("Total fertility rate", 
"1800", "1801", "1802", "1803", "1804", "1805"), row.names = c(NA, 
-12L), class = c("tbl_df", "tbl", "data.frame"))
```

```{r}
fertilityData
```


#### How you would plot this data?

---

## Tidy data

```{r, echo=FALSE}
knitr::include_graphics("http://r4ds.had.co.nz/images/tidy-1.png")
```

It is easier to work and reason with

- operations

- manipulation

- visualization

Learn more at http://tidyr.tidyverse.org/articles/tidy-data.html.

---

### Tidy prevthe ious data

```{r}
library(tidyverse)

(fertilityDataTidy <- fertilityData %>%
   rename(Country = `Total fertility rate`) %>%
   gather(key = "Year", value = "Fertility", -Country))
```

---

### This is easier to plot

```{r, out.width = "70%", fig.asp = 0.7}
ggplot(data = fertilityDataTidy) + 
  geom_point(mapping = aes(x = Year, y = Fertility))
```

---

class: center, middle, inverse

# Customization

---

## Add colors

```{r, out.width = "80%", fig.asp = 0.7}
ggplot(data = fertilityDataTidy) + 
  geom_point(mapping = aes(x = Year, y = Fertility, 
                           color = Country))
```

---

### Add lines: move 'aes' to the top (1/2)

```{r, out.width = "70%", fig.asp = 0.7}
ggplot(fertilityDataTidy, aes(Year, Fertility, color = Country)) + 
  geom_point() +
  geom_line()
```

---

### Add lines: add a group (2/2)

```{r, out.width = "80%", fig.asp = 0.7}
ggplot(fertilityDataTidy, aes(Year, Fertility, color = Country)) + 
  geom_point() +
  geom_line(aes(group = Country))
```

---

### My custom theme: black and white and larger fonts

```{r out.width = "70%", fig.asp = 0.7}
bigstatsr:::MY_THEME(
  ggplot(fertilityDataTidy, aes(x = Year, y = Fertility, 
                                color = Country)), coeff = 1.2
) + 
  geom_point() +
  geom_line(aes(group = Country))
```

---

### Larger points and lines

```{r out.width = "70%", fig.asp = 0.7}
bigstatsr:::MY_THEME(
  ggplot(fertilityDataTidy, aes(x = Year, y = Fertility, 
                                color = Country)), coeff = 1.2
) + 
  geom_point(cex = 4) +
  geom_line(aes(group = Country), lwd = 2)
```

---

```{r out.width = "85%", fig.asp = 0.7, fig.width=8}
bigstatsr:::MY_THEME(
  ggplot(fertilityDataTidy, aes(x = Year, y = Fertility, 
                                color = Country)), coeff = 1.2
) + 
  geom_point(cex = 4) +
  geom_line(aes(group = Country), lwd = 2) +
  theme(aspect.ratio = 0.8, 
        legend.key.width = unit(3, "line"))
```



---

class: center, middle, inverse

# Thanks!

.footnote[Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).]
